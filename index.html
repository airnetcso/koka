<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TEST KOSA KATA</title>
<style>
@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
body {
font-family: 'Segoe UI', system-ui, Arial, sans-serif; min-height: 100vh;
background: url('https://raw.githubusercontent.com/airnetcso/eps/main/image/bg1.jpg') no-repeat center center fixed;
background-size: cover; display: flex; flex-direction: column; justify-content: center; align-items: center;
padding: 20px; color: #fff; position: relative;
}
body::before { content: ''; position: absolute; inset: 0; background: rgba(0, 0, 0, 0.3); z-index: 1; }
.container { position: relative; z-index: 2; width: 80%; max-width: 440px; max-height: 90vh; overflow-y: auto;
-webkit-overflow-scrolling: touch; background: rgba(255,255,255,0.15); backdrop-filter: blur(14px);
-webkit-backdrop-filter: blur(14px); border-radius: 24px; padding: 30px 30px;
box-shadow: 0 15px 40px rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.18);
animation: fadeIn 0.8s ease-out; margin-top: -100px;
}
h1 { font-size: 32px; text-align: center; margin: 0 0 30px; color: #fff; font-weight: 700; text-shadow: 0 2px 8px rgba(0,0,0,0.6); }
input[type="text"], input[type="password"] { width: 100%; padding: 16px; margin: 14px 0; font-size: 18px; border: 2px solid rgba(255,255,255,0.4);
border-radius: 12px; box-sizing: border-box; background: rgba(255,255,255,0.12); color: white; transition: all 0.3s ease; }
input::placeholder { color: rgba(255,255,255,0.7); }
input:focus { border-color: #fff; background: rgba(255,255,255,0.22); outline: none; box-shadow: 0 0 0 4px rgba(255,255,255,0.15); }
button { width: 100%; padding: 16px; margin: 16px 0 8px; font-size: 20px; font-weight: bold; border: none;
border-radius: 12px; color: white; cursor: pointer; background: linear-gradient(90deg, #10b981, #059669); transition: all 0.3s ease; }
button:hover { transform: translateY(-3px); box-shadow: 0 12px 25px rgba(16,185,129,0.4); }
.error { color: #ff6b6b; text-align: center; margin: 12px 0; font-weight: 600; background: rgba(0,0,0,0.4); padding: 10px; border-radius: 10px; }
.hidden { display: none !important; }
#timer { text-align: center; font-size: 28px; color: #fee2e2; font-weight: bold; margin: 20px 0; background: rgba(220,38,38,0.25); padding: 12px; border-radius: 12px; }
.progress { height: 12px; background: rgba(255,255,255,0.15); border-radius: 6px; margin: 20px 0; overflow: hidden; }
.progress-bar { height: 100%; background: linear-gradient(90deg, #10b981, #059669); width: 0%; transition: width 0.6s ease; }
.question strong { font-size: 42px; display: block; margin: 40px 0 25px; color: #fff; text-align: center; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
.wrong-list { font-size: 17px; line-height: 1.8; margin: 25px 0; background: rgba(254,243,199,0.9); color: #92400e; padding: 20px; border-radius: 12px; border-left: 5px solid #ca8a04; }
.footer { position: relative; z-index: 2; margin-top: 40px; font-size: 14px; color: rgba(255,255,255,0.85); text-shadow: 0 1px 3px rgba(0,0,0,0.6); }
</style>
</head>
<body>
<div class="container" id="loginPage">
<h1>TEST KOSA KATA</h1>
<input type="text" id="username" placeholder="Username / ì´ë¦„" autocomplete="off">
<input type="password" id="password" placeholder="Password / ë¹„ë°€ë²ˆí˜¸" autocomplete="off">
<input type="text" id="kodeSoal" placeholder="Kode Test / ì‹œí—˜ì½”ë“œ" autocomplete="off">
<div class="error" id="errorMsg"></div>
<button onclick="login()">MULAI / ì‹œìž‘</button>
</div>

<div class="container hidden" id="quizPage">
<h1>TEST KOSA KATA</h1>
<div id="timer">50:00</div>
<div class="progress"><div class="progress-bar" id="progressBar"></div></div>
<div id="questionArea">
<div class="question"><strong id="currentWord"></strong></div>
<input type="text" id="answerInput" placeholder="Ketik jawaban di sini" autocomplete="off">
<button onclick="submitAnswer()">SUBMIT</button>
</div>
<div id="resultArea" class="hidden">
<h2 style="color:#fff; margin-bottom:20px;">Hasil Test</h2>
<p id="scoreText" style="font-size:28px; font-weight:bold; color:#d1fae5;"></p>
<div id="wrongWords" class="wrong-list hidden"></div>
<button onclick="restartQuiz()" style="background:linear-gradient(90deg, #3b82f6, #2563eb);">ULANGI LAGI</button>
</div>
</div>

<div class="footer">Â© 2026 Denzuka - Kim Jongun. All rights reserved.</div>

<script>
const users=[
  {username:"user1",password:"12345"},
  {username:"hanarizka",password:"Nungkihana24!"},
  {username:"Heri",password:"heri99"},
  {username:"siswa01",password:"12345"},
  {username:"windi",password:"Windi2000"},
  {username:"rismaya97",password:"bahasakorea"},
  {username:"wantikas",password:"200022",role:"admin"},
  {username:"Fikrisurya",password:"464646"},
  {username:"Mutiara2003",password:"Mutiara14"},
  {username:"sita77",password:"minyooki"},
  {username:"Aini185",password:"Doraemon"},
  {username:"Hangeulfei",password:"studykorea02"},
  {username:"Hamdan106",password:"Fukuo106"}
];

const kodeMapping = {
"H050126": "soal1.json",
"SAREWAE": "test.json",
"R43213": "soal2.json",
"Z21985": "soal3.json"
};

let questions = [], currentIndex = 0, score = 0, wrongList = [], timerInterval, timeLeft = 3000;
let username = "", kodeSoal = "";

const synonyms = {
"penyedot debu":["vakum","vacum","vacuum","vacuum cleaner","pengisap debu","penghisap debu"],
"kulkas":["lemari es","refrigerator","pendingin"],
"televisi":["tv","tivi"],
"tempat tidur":["kasur","dipan","bed"],
"mesin cuci":["sewatki"],
"sofa":["kursi sofa"],
"meja belajar":["meja kerja","desk"],
"lemari pakaian":["wardrobe","almari baju","closet"],
"kipas angin":["fan"],
"ac":["air conditioner","pendingin ruangan"],
"rice cooker":["penanak nasi","magic com","magic jar","magicom"],
"kompor gas":["kompor"],
"setrika":["gosokan"],
"gorden":["tirai","curtain"]
};

function normalizeAnswer(ans){return ans.toLowerCase().trim().replace(/[^a-z0-9\s]/g,'');}
function getNormalizedCorrectAnswers(q){return Array.isArray(q.indo)?q.indo.map(a=>normalizeAnswer(a)):[normalizeAnswer(q.indo)];}
function levenshtein(a,b){const matrix=Array(b.length+1).fill().map(()=>Array(a.length+1).fill(0));for(let i=0;i<=a.length;i++)matrix[0][i]=i;for(let j=0;j<=b.length;j++)matrix[j][0]=j;for(let j=1;j<=b.length;j++){for(let i=1;i<=a.length;i++){const ind=a[i-1]===b[j-1]?0:1;matrix[j][i]=Math.min(matrix[j][i-1]+1,matrix[j-1][i]+1,matrix[j-1][i-1]+ind);}}return matrix[b.length][a.length];}

async function loadQuestions(fileName){
  const resp=await fetch(fileName);
  if(!resp.ok)throw new Error("File soal tidak ditemukan atau error");
  questions=await resp.json();
  questions.sort(()=>0.5-Math.random());
}

function login(){
  username=document.getElementById("username").value.trim();
  const pass=document.getElementById("password").value.trim();
  kodeSoal=document.getElementById("kodeSoal").value.trim().toUpperCase();
  const error=document.getElementById("errorMsg");
  error.textContent="";
  if(!username||!pass||!kodeSoal){error.textContent="Lengkapi semua kolom!";return;}
  const fileName=kodeMapping[kodeSoal];
  if(!fileName){error.textContent="Kode akses tidak valid!";return;}
  const user=users.find(x=>x.username===username&&x.password===pass);
  if(user&&user.role==="admin"){location.href="https://airnetcso.github.io/admin/";return;}
  loadQuestions(fileName).then(()=>{
    document.getElementById("loginPage").classList.add("hidden");
    document.getElementById("quizPage").classList.remove("hidden");
    startQuiz();
  }).catch(err=>{error.textContent="Gagal memuat soal: "+err.message;console.error(err);});
}

function startQuiz(){
  currentIndex=0;score=0;wrongList=[];timeLeft=3000;updateTimer();
  timerInterval=setInterval(()=>{timeLeft--;updateTimer();if(timeLeft<=0)finishQuiz();},1000);
  nextQuestion();
}

function updateTimer(){const m=String(Math.floor(timeLeft/60)).padStart(2,'0');const s=String(timeLeft%60).padStart(2,'0');document.getElementById("timer").textContent=`${m}:${s}`;}
function updateProgress(){const p=((currentIndex)/questions.length)*100;document.getElementById("progressBar").style.width=p+"%";}
function nextQuestion(){if(currentIndex>=questions.length){finishQuiz();return;}document.getElementById("currentWord").textContent=questions[currentIndex].korea;document.getElementById("answerInput").value="";document.getElementById("answerInput").focus();updateProgress();}
function submitAnswer(){const a=document.getElementById("answerInput").value.trim();if(!a)return;checkAnswer(a);}
function checkAnswer(ans){const q=questions[currentIndex];const normUser=normalizeAnswer(ans);const correctAnswers=getNormalizedCorrectAnswers(q);let isCorrect=correctAnswers.some(c=>c===normUser);if(!isCorrect){for(const c of correctAnswers){if(levenshtein(normUser,c)<=2){isCorrect=true;break;}}}for(const [key,vals] of Object.entries(synonyms)){const nk=normalizeAnswer(key);const synMatch=normUser===nk||vals.some(v=>normUser.includes(v.toLowerCase())||v.toLowerCase().includes(normUser));if(synMatch&&correctAnswers.some(c=>c===nk)){isCorrect=true;break;}}if(!isCorrect){wrongList.push({word:q.korea,correct:Array.isArray(q.indo)?q.indo.join(" / "):q.indo,your:ans});}else{score++;}currentIndex++;nextQuestion();}

function finishQuiz(){
  clearInterval(timerInterval);
  document.getElementById("questionArea").classList.add("hidden");
  document.getElementById("resultArea").classList.remove("hidden");
  const percent=Math.round((score/questions.length)*100);
  document.getElementById("scoreText").textContent=`Skor: ${score}/${questions.length} (${percent}%)`;
  let motivasi="";
  if(percent>90)motivasi="MANTAP SEKALI! Kamu luar biasa!";
  else if(percent>=80)motivasi="Bagus sekali! Tetap semangat belajar ya!";
  else if(percent>=60)motivasi="Ayo semangat lagi! Kamu pasti bisa lebih baik!";
  else motivasi="Jangan menyerah ya! Terus latihan, pasti naik kok!";
  const motivEl=document.createElement("p");motivEl.textContent=motivasi;motivEl.style.fontSize="24px";motivEl.style.fontWeight="bold";motivEl.style.color="#d1fae5";motivEl.style.marginTop="20px";motivEl.style.textAlign="center";
  document.getElementById("resultArea").insertBefore(motivEl,document.getElementById("wrongWords"));
  const wrongDiv=document.getElementById("wrongWords");wrongDiv.innerHTML="";if(wrongList.length>0){wrongDiv.classList.remove("hidden");wrongDiv.innerHTML="<strong>Kata yang salah:</strong><br>";wrongList.forEach(item=>{wrongDiv.innerHTML+=`â€¢ ${item.word} â†’ ${item.correct} (jawaban kamu: ${item.your})<br>`;});}

  // ==== KIRIM KE GOOGLE SHEET ====
  const ggSheetURL = "https://script.google.com/macros/s/AKfycbzAbhQBoTlcC_pCoqhHkH0wR1V9DlzcKGPTQq021Ma_Dz-rBpSNKLm-netIV90SHoYcWg/exec";
  fetch(ggSheetURL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      username,
      kode: kodeSoal||"-",
      score,
      percent,
      wrongList,
      app:"koka"
    })
  }).then(res=>res.json()).then(res=>console.log("Google Sheet response:",res)).catch(err=>console.error("Gagal kirim ke Sheet:",err));

  // ==== KIRIM KE WHATSAPP GURU ====
  const nomorGuru="628385551800";
  const pesanWA=encodeURIComponent(
`ðŸ“š *Hasil Test Kosa Kata Korea* ðŸ“š

ðŸ‘¤ Nama Siswa: ${username}
ðŸ”‘ Kode Soal: ${kodeSoal||"-"}
ðŸ“Š Skor: ${score}/${questions.length}
ðŸ† Persentase: ${percent}%
â° Waktu Submit: ${new Date().toLocaleString('id-ID')}

Terima kasih sudah mengerjakan! ðŸ’ª
- Aplikasi /koka by Denzuka`
  );
  window.open(`https://api.whatsapp.com/send?phone=${nomorGuru}&text=${pesanWA}`,"_blank");

  // ==== SIMPAN DI LOCALSTORAGE ====
  const resultData={username, kode: kodeSoal||"-", nilai:`${score}/${questions.length} (${percent}%)`, tanggal:new Date().toLocaleString('id-ID'), app:"koka"};
  let allResults=JSON.parse(localStorage.getItem("quizResults")||"[]");
  if(!allResults.some(r=>r.username===resultData.username&&r.kode===resultData.kode&&r.nilai===resultData.nilai&&r.app==="koka")){
    allResults.push(resultData);
    localStorage.setItem("quizResults",JSON.stringify(allResults));
  }
}

function restartQuiz(){
  document.getElementById("resultArea").classList.add("hidden");
  document.getElementById("questionArea").classList.remove("hidden");
  document.getElementById("quizPage").classList.add("hidden");
  document.getElementById("loginPage").classList.remove("hidden");
  document.getElementById("username").value="";
  document.getElementById("password").value="";
  document.getElementById("kodeSoal").value="";
  document.getElementById("errorMsg").textContent="";
}
</script>
</body>
</html>
