<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TEST KOSA KATA</title>

<style>
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
html,body{height:100%;margin:0;overflow:hidden}
body{
font-family:'Segoe UI',system-ui,Arial,sans-serif;
background:url('https://raw.githubusercontent.com/airnetcso/eps/main/image/bg1.jpg') no-repeat center/cover fixed;
display:flex;flex-direction:column;align-items:center;justify-content:center;
color:#fff;position:relative;padding:20px
}
body::before{content:'';position:absolute;inset:0;background:rgba(0,0,0,.3);z-index:1}
.container{
z-index:2;width:80%;max-width:440px;max-height:90vh;overflow-y:auto;
background:rgba(255,255,255,.15);backdrop-filter:blur(14px);
border-radius:24px;padding:30px;box-shadow:0 15px 40px rgba(0,0,0,.35);
animation:fadeIn .8s;margin-top:-100px
}
h1{text-align:center;margin-bottom:30px}
input,button{
width:100%;padding:16px;font-size:18px;border-radius:12px;border:none;margin:12px 0
}
input{background:rgba(255,255,255,.15);color:#fff}
button{background:linear-gradient(90deg,#10b981,#059669);color:#fff;font-weight:bold;cursor:pointer}
.error{color:#ff6b6b;text-align:center}
.hidden{display:none!important}
#timer{text-align:center;font-size:28px;background:rgba(220,38,38,.25);padding:12px;border-radius:12px}
.progress{height:12px;background:rgba(255,255,255,.15);border-radius:6px;margin:20px 0}
.progress-bar{height:100%;background:linear-gradient(90deg,#10b981,#059669);width:0%}
.question strong{font-size:42px;text-align:center;display:block;margin:30px 0}
.wrong-list{background:#fef3c7;color:#92400e;padding:20px;border-radius:12px}
.footer{margin-top:40px;font-size:14px;z-index:2}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="container" id="loginPage">
<h1>TEST KOSA KATA</h1>
<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">
<input id="kodeSoal" placeholder="Kode Test">
<div class="error" id="errorMsg"></div>
<button onclick="login()">MULAI</button>
</div>

<!-- QUIZ -->
<div class="container hidden" id="quizPage">
<h1>TEST KOSA KATA</h1>
<div id="timer">50:00</div>
<div class="progress"><div class="progress-bar" id="progressBar"></div></div>

<div id="questionArea">
<div class="question"><strong id="currentWord"></strong></div>
<input id="answerInput" placeholder="Ketik jawaban">
<button onclick="submitAnswer()">SUBMIT</button>
</div>

<div id="resultArea" class="hidden">
<h2>Hasil Test</h2>
<p id="scoreText"></p>
<div id="wrongWords" class="wrong-list hidden"></div>
<button onclick="restartQuiz()">ULANGI</button>
</div>
</div>

<div class="footer">© 2026 Denzuka</div>

<script>
/* ================== KONFIG ================== */

// API GOOGLE SHEET (HASIL)
const SHEET_POST_URL =
"https://script.google.com/macros/s/AKfycbzXCl1rF-RKZGQ83W_lhIU_X-Zd95hboU8hxdHQZQRHKoEo6KMIG6Iio9ypAelsJsJD5Q/exec";

// USER
const users=[
{username:"user1",password:"12345"},
{username:"hanarizka",password:"Nungkihana24!"},
{username:"wantikas",password:"200022",role:"admin"}
];

// KODE → FILE SOAL
const kodeMapping={
"H050126":"soal1.json",
"SAREWAE":"soal2.json",
"R43213":"soal3.json"
};

/* ================== VAR ================== */
let questions=[],currentIndex=0,score=0,wrongList=[];
let timerInterval,timeLeft=3000;
let username="",kodeSoal="";

/* ================== UTIL ================== */
const norm=t=>t.toLowerCase().trim();

/* ================== LOAD SOAL ================== */
async function loadQuestions(file){
const r=await fetch(file);
if(!r.ok)throw new Error("File soal tidak ditemukan");
questions=await r.json();
questions.sort(()=>Math.random()-0.5);
}

/* ================== LOGIN ================== */
function login(){
username=usernameInput.value.trim();
kodeSoal=kodeSoalInput.value.trim().toUpperCase();
const pass=password.value.trim();
errorMsg.textContent="";

if(!username||!pass||!kodeSoal){
errorMsg.textContent="Lengkapi semua kolom";return;
}

const u=users.find(x=>x.username===username&&x.password===pass);
if(!u){errorMsg.textContent="Login gagal";return;}

const file=kodeMapping[kodeSoal];
if(!file){errorMsg.textContent="Kode soal tidak valid";return;}

loadQuestions(file).then(()=>{
loginPage.classList.add("hidden");
quizPage.classList.remove("hidden");
startQuiz();
}).catch(e=>errorMsg.textContent=e.message);
}

/* ================== QUIZ ================== */
function startQuiz(){
currentIndex=0;score=0;wrongList=[];timeLeft=3000;
timerInterval=setInterval(()=>{
timeLeft--;updateTimer();
if(timeLeft<=0)finishQuiz();
},1000);
nextQuestion();
}

function updateTimer(){
timer.textContent=
`${String(Math.floor(timeLeft/60)).padStart(2,'0')}:${String(timeLeft%60).padStart(2,'0')}`;
}

function updateProgress(){
progressBar.style.width=((currentIndex/questions.length)*100)+"%";
}

function nextQuestion(){
if(currentIndex>=questions.length){finishQuiz();return;}
currentWord.textContent=questions[currentIndex].korea;
answerInput.value="";answerInput.focus();
updateProgress();
}

function submitAnswer(){
const ans=norm(answerInput.value);
if(!ans)return;
const q=questions[currentIndex];
if(ans===norm(q.indo)) score++;
else wrongList.push(`${q.korea} → ${q.indo}`);
currentIndex++;nextQuestion();
}

/* ================== FINISH ================== */
function finishQuiz(){
clearInterval(timerInterval);
questionArea.classList.add("hidden");
resultArea.classList.remove("hidden");

const percent=Math.round((score/questions.length)*100);
scoreText.textContent=`Skor ${score}/${questions.length} (${percent}%)`;

if(wrongList.length){
wrongWords.classList.remove("hidden");
wrongWords.innerHTML="<b>Jawaban Salah:</b><br>"+wrongList.join("<br>");
}

/* ====== KIRIM KE GOOGLE SHEET ====== */
fetch(SHEET_POST_URL,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
username,
kode:kodeSoal,
app:"kosa-kata",
score,
percent,
wrongList
})
}).catch(()=>{});
}

function restartQuiz(){location.reload();}
</script>

</body>
</html>
