// === GANTI DENGAN NAMA SHEET KAMU ===
const SHEET_NAME = "DATA"; // ubah kalau nama sheetmu beda, misal "Hasil Quiz"

// Jangan ubah kode di bawah ini kalau tidak perlu
function doPost(e) {
  try {
    let data;
    
    // Coba ambil dari POST JSON dulu
    if (e.postData && e.postData.contents) {
      data = JSON.parse(e.postData.contents);
    } else {
      // Kalau gagal, fallback ke parameter GET
      return handleGet(e);
    }
    
    const sheet = getSheet();
    
    // Tambah baris baru sesuai urutan kolom
    sheet.appendRow([
      new Date(),                          // WAKTU (otomatis timestamp server)
      data.namaSiswa || "Anonymous",       // NAMA SISWA
      data.code || "Unknown",              // CODE
      data.kosaKata || "",                 // KOSA KATA (misal: 45/50 (90%))
      data.ubt || "-",                     // UBT (bisa diisi nanti)
      data.latihanSoal || "",              // LATIHAN SOAL (jumlah soal)
      data.keterangan || ""                // KETERANGAN (daftar salah atau "Semua benar!")
    ]);
    
    // Respon sukses ke quiz HTML
    return ContentService
      .createTextOutput(JSON.stringify({status: "success", message: "Data berhasil disimpan"}))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    // Kalau ada error, kasih respon error
    return ContentService
      .createTextOutput(JSON.stringify({status: "error", message: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Support fallback kalau POST gagal (quiz akan buka tab baru dengan GET)
function doGet(e) {
  try {
    const data = e.parameter;
    
    const sheet = getSheet();
    
    sheet.appendRow([
      new Date(),
      data.namaSiswa || "Anonymous",
      data.code || "Unknown",
      data.kosaKata || "",
      data.ubt || "-",
      data.latihanSoal || "",
      data.keterangan || ""
    ]);
    
    return ContentService
      .createTextOutput(JSON.stringify({status: "success (GET fallback)", message: "Data disimpan via GET"}))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({status: "error", message: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Fungsi bantu buat ambil sheet
function getSheet() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  let sheet = ss.getSheetByName(SHEET_NAME);
  
  // Kalau sheet belum ada, buat otomatis + header
  if (!sheet) {
    sheet = ss.insertSheet(SHEET_NAME);
    sheet.appendRow([
      "WAKTU",
      "NAMA SISWA",
      "CODE",
      "KOSA KATA",
      "UBT",
      "LATIHAN SOAL",
      "KETERANGAN"
    ]);
    // Format header biar bagus
    const headerRange = sheet.getRange("A1:G1");
    headerRange.setFontWeight("bold");
    headerRange.setBackground("#10b981");
    headerRange.setFontColor("white");
    sheet.setFrozenRows(1);
  }
  
  return sheet;
}
